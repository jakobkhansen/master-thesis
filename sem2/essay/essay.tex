% TODO add sidetall pÃ¥ alle kilder

\documentclass[12pt]{article}

\setlength\parindent{0pt}

\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage[a4paper, total={}]{geometry}
\setlength{\headsep}{5pt}
\setlength{\parskip}{1em}
\usepackage{listings}

\definecolor{pblue}{rgb}{0.2,0.2,0.7}
% \definecolor{pgreen}{rgb}{0,0.5,0}
\definecolor{pred}{rgb}{0.7,0.2,0.2}
\definecolor{pgrey}{rgb}{0.46,0.45,0.48}

\lstset{
  backgroundcolor = \color{lightgray},
  language=Bash,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}

\hbadness=10000

\usetikzlibrary{automata, positioning, arrows}

\tikzset{
    ->,
    node distance=3cm,
    initial text=$ $,
}

\title{\vspace{-20px}Real-time management of code clones in an IDE environment}
% Alternative: \title{IDE-agnostic management of code clones }

\author{Jakob Hansen}

\date{\today}

\begin{document}
\maketitle

\tableofcontents

\section{Introduction}

Refactoring is the process of restructuring code in order to improve the internal behavior
of the code, without changing the external behavior.\cite[9]{fowlerrefactoring} Refactoring
is often done in order to eliminate ``smelly`` code.

A study conducted by Diego Cedrim et al.\cite{Rohit_Gheyi_Impact} has shown that while
developers tend to refactor smelly code, they are rarely successful at eliminating the
smells they are targetting. A large portion of refactorings even tend to make the code
smellier. Therefore, automated tools to help developers make better refactorings and
perform code analysis is an important field of research.

Duplicated code is a code smell which occurs in practically every large software project.
Code clone analysis has recently become a highly active field of research and many tools have
been developed to detect duplicated code.\cite[7]{Inoue_introduction_to_cc} However, few of
these tools reached and see use in the industry and few have the capability of detecting
more intricate types of duplicated code and managing them in a real-time IDE environment. 

This thesis will present a tool for industry viable clone detection and management. It
will explore the topics of finding and managing clones in real-time, refactoring-oriented
clone detection and providing clone management in a modern IDE environment.

\section{Background}

\subsection{Software quality}

\subsubsection{Software quality metrics}

\subsubsection{How refactoring affects software quality}

\subsubsection{Duplicated code}

As stated, duplicated code damages software quality in practically every large software
project. Duplicated code can lead to a plethora of anti-patterns like Shotgun-Surgery and
Divergent-Change, and will often lead to an increase in technical debt for the
project.\cite[99]{fowlerrefactoring}

Statistic about percentage of duplicated code here.

\subsection{Code clones}

We define a code snippet as a piece of software code in a larger software system. A code
clone is then defined as a code snippet which is equal to or similar to another code
snippet. The two code snippets are both code clones and together they form a code clone
pair. 

\subsubsection{The clone relation}
The clone relation defines a relation between code snippets where snippets which are
code clones are related to each other. The clone relation is reflexive and symmetric, but
not always transitive. The transitive property depends on the treshold for similarity when
identifying code clones. Given

$$a \xrightarrow{clone} b \xrightarrow{clone} c$$

where $a,b,c$ are code snippets and $\xrightarrow{clone}$ gives the clone relation, $a$ is
a clone of $b$, but not necessarily similar enough to be a clone of $c$, depending on the
threshold for similarity.

\subsubsection{Code clone types}

Code clones are generally classified into four types.\cite{Inoue_introduction_to_cc} These
types classify code snippets as code clones with an increasing amount of leniency.
Therefore Type-1 code clones are very similar, while Type-4 clones are not necessarily
similar at all. However, all code clones do still have the same functionality, it is the
syntactic and structual differences which distinguish the types. The set of code clones
classified by a code clone type is also a subset of the next type, meaning all type-1
clones are also type-2 clones, but not vice versa.

The code clone types are defined as follows:

\textbf{Type-1} clones are syntactically identical. The only differences allowed are elements
without meaning, like comments and white-space. 

\textbf{Type-2} clones are structurally identical. Possible differences include
identifiers, literals and types. 

\textbf{Type-3} clones are required to be structurally similar, but not equal. Differences
include statements which are added, removed or modified. For this clone type one needs to
determine a threshold $\theta$ which determines how structurally different snippets can be
to be considered Type-3 clones.\cite{Inoue_introduction_to_cc}

\textbf{Type-4} are clones without any requirement for syntactical or structural similarity. Therefore
the only requirement is having the same functionality.

Type-1 clones are often referred to as ``exact`` clones, while Type-2 and Type-3 clones are
often referred to as ``near-miss`` clones.\cite[1]{Zibran_real_time_search}

\subsubsection{Code clone detection and management techniques}

Write about different techniques which are used and how well they work

\subsubsection{Clone aware development}

Developers are often not aware of the creation of clones in their code. Clone aware
development involves having clone management as a part of the software development
process. Since code clones can be hard to keep track of and manage, tools which help
developers deal with clones are useful. However, Mathias Rieger et al. claims that
a problem with many detection tools is that the tools ``report large amounts data that must
be treated with little tool support.``\cite[1]{InsightsSystemWideDuplication}. Existing
tools which partly solves this problem are presented below. 
\subsubsection{IDE-based clone management}

There are many existing clone management tools, however the most useful tools for clone
aware development are the tools which are integrated into an IDE and offer services to the
programmer while developing in real-time. 

The IDE-based tools which exist can be categorized as
follows\cite[8]{Udding_Towards_Convenient_Management}:

\begin{itemize}
    \item\textit{Copy-paste-clones:} This category of tools deals only with code snippets which are
    copy-pasted from another location in code. These tools therefore only track clones which
    are created when copy-pasting, and does not use any other detection techniques. Therefore
    this type of tool is not suitable for detecting clones which are made accidentally, since
    developers are aware that they are creating clones when pasting already existing code
    snippets.

    \item\textit{Clone detection and visualization tools:} This category of tools have more
    sophisticated clone detection capabilities and will detect code clones which occur
    accidentally.

    \item\textit{Versatile clone management:} This category of tools cover tools which provide more
    services than the above. Services like refactoring and simultaneous editing of clones fall
    under this category.
\end{itemize}

There are a few existing IDE-tools which have seen success in real-time detection of clones:

\begin{itemize}
        \item Minhaz et al. introduced a technique for performing real-time focused
            searches, i.e. searching only for code clones of a given code snippet. This
            technique can also detect Type-3 clones.\cite{Zibran_real_time_search} 
        This technique was later used in the tool
        \textit{SimEclipse}.\cite{Udding_Towards_Convenient_Management} Since this tool
        can only detect clones of a code snippet which the developer selects, this tool is
        not well suited for finding accidental clones.

        \item Another tool, SHINOBI can detect code clones in real-time without the need
            of the developer to select a code snippet, however it can only detect type-1
            and type-2 code clones.\cite{SHINOBI}
        \item The modern IDE IntelliJ has a built-in duplication detection and
            refactoring, it's able to detect type-1 and type-2 code clones at a method
            granularity and refactors by replacing one of the clones with a method call.
\end{itemize}

No tools which we are aware of have the capability of both reporting code clones without
fragment-selection and reporting type-3 clones.

\section{The way forward}

This thesis will attempt to provide and evaluate a modern tool which provides clone management
capabilities in a real-time IDE environment. The main goal will be to create a tool which
fits well into the development cycle and works in a real-time IDE environment. Areas of
focus will therefore be:

\begin{itemize}
    \item Real-time detection and management of code clones
    \item Code clone refactoring and detection of refactoring-oriented clones
    \item IDE tooling and IDE agnostic tooling like LSP\cite{}
    \item Clone ranking, which clones are ok to leave in the code?
\end{itemize}

\bibliography{refs}
\bibliographystyle{plain}

\end{document}

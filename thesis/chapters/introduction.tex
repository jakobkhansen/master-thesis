\chapter{Introduction}

Refactoring is the process of restructuring source code in order to improve the internal
behavior of the code, without changing the external behavior~\cite[9]{fowlerrefactoring}.
Refactoring source code is often performed in order to eliminate instances of bad code
quality, otherwise known as code smells.

A study conducted by Diego Cedrim et al. has shown that while programmers tend to refactor
smelly code, they are rarely successful at eliminating the smells they are
targeting~\cite{Rohit_Gheyi_Impact}. Most refactorings performed were either
``smell-neutral'', meaning that the code smell is not eliminated, or ``stinky'',
meaning that they introduced more code smells than they eliminated. Automated tools that
help programmers make better refactorings and perform code analysis could be a solution to
this problem.

Duplicated code, code which is more or less copied to different locations in a code base,
is a code smell which occurs in practically every large software project. Code clone
analysis (duplicate code analysis) has therefore in the last decade become a highly active
field of research and many tools have been developed to detect duplicated
code~\cite[6]{Inoue_introduction_to_cc}. This thesis will focus on this type of code
analysis, and implement an efficient algorithm and tool for detecting code clones which
targets the IDE scenario.

\section{Motivation and problem statement}

Many tools and algorithms exist for duplicate code detection. However, few of these have
the capability of efficiently detecting duplicated code in a real-time IDE environment.
The problem with existing algorithms is that most of them need to rerun the entire
analysis whenever a small change to a single file happens. Incremental algorithms that do
not recompute all clones from scratch are therefore interesting for use-cases such as in
IDEs while programming and for analyzing different Git revisions of the same source code,
but this type of algorithm has not been thoroughly explored for code clone analysis. This
limits the ability for programmers to easily detect duplicated code as they work, as the
existing tools are also often limited to specific programming languages or IDEs.

Our proposed solution and tool addresses this issue by introducing a new algorithm that is
capable of detecting and updating existing code clones as source code changes, which aims
to be faster than redoing the analysis from scratch. CCDetect-LSP, the tool which
implements this algorithm is also programming language and IDE agnostic, which allows
programmers to seamlessly incorporate the detection of duplicated code into their existing
development environment.

\section{Our contribution}

CCDetect-LSP provides clone detection capabilities in a real-time IDE environment. The
tool allows the user to list and interact with all the code clones in the code base, jump
between matching clones, and get quick feedback while editing code in order to determine
which clones are introduced/eliminated.

Existing incremental clone detection tools either do not fit into an IDE scenario, are
limited in terms of what clones they display, or have not been shown to scale well in
terms of processing time or memory usage for larger codebases. Therefore, this thesis will
focus on the following areas.

\textbf{Incremental clone detection:} The main focus of this thesis is making the tool
efficient in terms of incrementally updating the analysis whenever edits are performed in
the IDE. Most clone detection algorithms either only list clones of a specific code
snippet, or calculates clones from scratch in a manner which is too slow for an IDE
scenario. Our algorithm is based on a novel application and extension of dynamic suffix
arrays to quickly update and add/remove clones, faster than calculating the clones from
scratch. With this implementation, CCDetect-LSP can show all clones in the entire code
base at once, and efficiently update them whenever a file is edited.

\textbf{IDE and language agnostic clone detection:} CCDetect-LSP gives programmers the
ability to view clones in their IDE. Utilizing features of the language server protocol
(LSP) such as diagnostics and code-actions, the tool provides clone analysis to any editor
which implements the LSP protocol. As far as we are aware there are no other clone
detection tools which utilizes LSP to provide clone analysis. The tool is also language
agnostic in the sense that it only needs a grammar for a language to analyze it.

\section{Structure}

Chapter 2 provides some background on code clone analysis, some existing tools and some
preliminary algorithms and data structures used in the implementation. Chapter 3-5
describes the implementation of the tool and the algorithms used for initial and
incremental clone detection. In chapter 6, the tool is evaluated based on multiple
criteria, and compared to other existing solutions. Chapter 7 discusses the results of the
evaluation. Chapter 8 concludes the thesis and lists future work and research
opportunities.
